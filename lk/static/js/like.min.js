var interestData;function rebuildInterestData(g){var i=function(n,m){var o={};num=0;for(var k in m){var q=Math.round(m[k]*n);q=q>0?q:1;o[k]=q;num=num+q}var p=num-n;for(var k=p;0<k;k--){for(var d in o){var l=o[d];if(l>1){o[d]=l-1;break}}}return o};var a=function(m,p,v,n,u){var s=[],x="__SlicestartpoS__";var k=function(y){return y[x]?y[x]:0};var w=function(y,z){y[x]=z};var r=(function(){var z=[],y=[];for(var A in n){z.push({id:A,num:n[A]})}y=z.sort(function(D,B){var E=f[D.id];var C=f[B.id];if(E!==C){return C-E}else{return parseInt(B.id)-parseInt(D.id)}});return y})();var d=function(y,C){var B=[];var A=k(y);var z=A+C;w(y,z);B=y.slice(A,z);return B};var l=function(E){var D=[];for(var A=0,y=r.length;A<y;A++){var B=r[A].id;var C=p[B];var z=d(C,E-D.length);D=D.concat(z);if(D.length==E){break}}if(D.length<E){z=d(v,E-D.length);D=D.concat(z)}return D};var t=function(){var B=[];var z=[];for(var A=0,y=r.length;A<y;A++){var D=r[A].id,C=n[D],F=p[D];var E=d(F,C);if(E.length<C){z=l(C-E.length);E=E.concat(z)}B=B.concat(E)}if(B.length<m){z=l(m-B.length);B=B.concat(z)}return B};for(var o=0;o<u;o++){var q=(function(){var y=k(v);return y<v.length})();if(q){s.push(t())}}return s};var e=9,h=10,b=[],j=g.result,f=j.cate;all=j.all;data=j.data;var c=i(e,f);b=a(e,data,all,c,h);return b}function getPageData(e){var d=interestData[e],a=d.length,f=[],c="";for(var b=0;b<a;b++){f.push("<li>");f.push('<a href="'+d[b].url+'">'+d[b].title+"</a>");if(d[b].type===1&&d[b].thumb!=""){f.push('<em class="p_newslist_ico"><i class="p_newslist_ico_pic"></i></em>')}else{if(d[b].type===2){f.push('<em class="p_newslist_ico"> <i class="p_newslist_ico_pic"></i></em>')}else{if(d[b].type===3){f.push('<em class="p_newslist_ico"><i class="p_newslist_ico_video"></i></em>')}}}f.push("</li>")}c=f.join("");return c}function interestInit(){var e=[],c=getPageData(0),a=interestData.length;e.push('<ul id="j_interestList" class="p_newslist">');e.push(c);e.push("</ul>");e.push('<a id="j_updateInterest" data-page="0" href="javascript:void(0);" class="p_newsmore">鎹竴鎹�(<span>1</span>/'+a+")</a>");var b=e.join(""),d=$("#j_loadInterestTip");if(d.length>0){d.hide();d.before(b)}$(document).on("click tap","#j_updateInterest",updateInterest)}function updateInterest(){var f=$("#j_interestList"),e=$("#j_updateInterest"),a=e.find("span"),d=e.data("page"),b=interestData.length;d=d+1;d=d==b?0:d;e.data("page",d);a.html(d+1);var c=getPageData(d);f.html(c)}function loadInterest(){if(typeof hash=="undefined"&&hash==""){return false}var c="?hash="+hash,b=(typeof uid=="undefined"||uid=="")?"":("&uid="+uid),a=c+b;$.ajax({url:"http://interest.dp.sina.cn/api/cate/wap"+a,async:false,type:"GET",dataType:"jsonp",success:function(e){interestData=rebuildInterestData(e);var d=interestData.length-1;if(interestData[d].length<interestData[d-1].length){interestData.splice(d,1)}interestInit()},error:function(e,d){}})}setTimeout(loadInterest,2000);var getCookie=function(a){a=a.replace(/([\.\[\]\$])/g,"\\$1");var c=new RegExp(a+"=([^;]*)?;","i");var d=document.cookie+";";var b=d.match(c);if(b){return unescape(b[1])||""}else{return""}};function interestStatistic(b,i){if(i==""){return false}var b=$(b),f="",c=getCookie("ustat"),a=c!=""?c:"",d=stat.userId!=""?stat.userId:"",j="news_like",e="",h=document.referrer?document.referrer:"";var k=new Date().getTime(),g=k+Math.random().toString().slice(2);window.img=new Image();img.src="http://beacon.sina.com.cn/e.gif?UATrack||"+a+"||"+f+"||"+d+"||"+j+"||"+i+"||"+h+"||"+e+"||&gUid_"+g}function interestStatistic2(f){f.preventDefault();var b=$(f.target),g=b.attr("href"),k="title",h="",c=getCookie("ustat"),a=c!=""?c:"",d=stat.userId!=""?stat.userId:"",l="news_like",j=document.referrer?document.referrer:"";var m=new Date().getTime(),i=m+Math.random().toString().slice(2);window.img=new Image();img.src="http://beacon.sina.com.cn/e.gif?UATrack||"+a+"||"+h+"||"+d+"||"+l+"||"+k+"||"+j+"||"+g+"||&gUid_"+i;setTimeout(function(){location.href=g},500)}$(document).on("click tap","#j_interestList li a",interestStatistic2);$(document).on("click tap","#j_updateInterest",function(){interestStatistic(this,"change")});
